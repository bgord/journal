<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="description" content="Journal" />

    <link as="style" rel="stylesheet preload" href="/public/main.min.css" />
    <link as="style" rel="stylesheet preload" href="/public/custom.css" />

    <title>Journal</title>
  </head>

  <body data-mx="auto" data-bg="neutral-950">
    <main data-stack="y" data-gap="8">
      <header data-stack="x" data-main="between" data-cross="center" data-py="2" data-px="4">
        <div class="logo" data-fs="4xl" data-fw="bold" data-ls="wider" data-color="brand-600">
          <a href="/">Journal</a>
        </div>
      </header>

      <form
        id="login"
        action="/api/auth/sign-in/email"
        method="post"
        data-status="initial"
        data-stack="y"
        data-gap="4"
        data-mx="auto"
        data-p="8"
        data-md-p="5"
        data-bg="neutral-900"
        data-br="xs"
        data-width="100%"
        style="max-width: 400px"
      >
        <legend data-fs="xl" data-lh="none" data-color="neutral-200" data-mb="5">Login</legend>

        <div data-stack="y">
          <label class="c-label" for="email">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            class="c-input"
            autofocus
            required
            placeholder="user@example.com"
            inputmode="email"
            autocomplete="email"
            autocapitalize="none"
            spellcheck="false"
            enterKeyHint="next"
          />
        </div>

        <div data-stack="y">
          <label class="c-label" for="password">Password</label>
          <input
            id="password"
            name="password"
            class="c-input"
            type="password"
            placeholder="*********"
            autocomplete="new-password"
            enterKeyHint="send"
          />
        </div>

        <button data-when="initial error" class="c-button" data-variant="primary" type="submit">
          Sign in
        </button>
        <button data-when="pending" class="c-button" data-variant="primary" type="submit" disabled>
          Signing in...
        </button>
        <button data-when="success" class="c-button" data-variant="primary" type="submit" disabled>
          Sign in
        </button>

        <div data-when="error" data-bg="neutral-700" data-color="neutral-200" data-p="3" data-fs="sm">
          Something went wrong
        </div>

        <p data-transform="center" data-color="neutral-400" data-mt="5" data-fs="sm">
          Do not have an account?
          <a class="c-link" href="/public/register.html" data-decoration="underline">Register</a>
        </p>

        <a class="c-link" href="/public/forgot-password.html" data-decoration="underline" data-mx="auto">
          Forgot password?
        </a>
      </form>

      <script>
        const form = document.querySelector("#login");

        form.dataset.status = "initial";

        form.addEventListener("submit", async (event) => {
          event.preventDefault();

          if (form.dataset.status === "pending") return;
          if (!form.reportValidity()) return;

          form.dataset.status = "pending";

          try {
            const data = new FormData(form);

            const response = await fetch(form.action, {
              method: form.method,
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(Object.fromEntries(data)),
              credentials: "include",
            });

            form.dataset.status = response.ok ? "success" : "error";

            if (response.ok) {
              form.reset();
              form.dataset.status = "success";
              location.replace("/?filter=last_week&query=");
            } else {
              form.dataset.status = "error";
            }
          } catch {
            form.dataset.status = "error";
          }
        });
      </script>
    </main>
  </body>
</html>
